<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Quiz Halloween</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #2c003e;
      color: #fff;
      text-align: center;
    }

    #quiz, #results, #adminPanel {
      display: none;
    }

    .question {
      margin: 20px;
      font-size: 20px;
    }

    button {
      margin: 10px;
      padding: 10px 20px;
      border: none;
      cursor: pointer;
      border-radius: 8px;
    }

    .correct { background: green; color: white; }
    .wrong { background: red; color: white; }

    #countdownDiv {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 5rem;
      color: white;
      z-index: 9999;
    }

    /* PÃ³dio */
    .podio {
      display: flex;
      justify-content: center;
      margin-top: 30px;
      gap: 20px;
    }
    .podio div {
      padding: 15px;
      border-radius: 10px;
      width: 120px;
      text-align: center;
      font-weight: bold;
      color: black;
    }
    .gold { background: gold; }
    .silver { background: silver; }
    .bronze { background: #cd7f32; }
  </style>
</head>
<body>
  <h1>Quiz de Halloween ðŸŽƒ</h1>

  <div id="start">
    <input type="text" id="nickname" placeholder="Digite seu nick">
    <button onclick="startGame()">Iniciar Quiz</button>
  </div>

  <div id="quiz"></div>
  <div id="results"></div>

  <!-- Admin Panel -->
  <div id="adminPanel">
    <h2>Todos os envios</h2>
    <table border="1" style="margin:0 auto; color:white;">
      <thead>
        <tr><th>#</th><th>Nick</th><th>Pontos</th><th>Tempo (s)</th><th>Data/Hora</th><th>AÃ§Ãµes</th></tr>
      </thead>
      <tbody id="submissions"></tbody>
    </table>
  </div>

  <!-- Sons -->
  <audio id="soundCorrect" src="acerto.mp3"></audio>
  <audio id="soundWrong" src="erro.mp3"></audio>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.12.3/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.3/firebase-firestore.js"></script>
  <script>
    // Config Firebase
    const firebaseConfig = {
      apiKey: "SUA_API_KEY",
      authDomain: "SEU_DOMINIO.firebaseapp.com",
      projectId: "SEU_PROJECT_ID",
      storageBucket: "SEU_BUCKET.appspot.com",
      messagingSenderId: "ID",
      appId: "ID"
    };
    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    let questions = [
      { q: "Qual criatura Ã© associada ao Halloween?", options: ["Coelho", "Fantasma", "Sapo"], answer: 1 },
      { q: "Qual cor representa o Halloween?", options: ["Laranja", "Azul", "Rosa"], answer: 0 }
    ];

    let currentQuestion = 0;
    let score = 0;
    let startTime, endTime, nickname;

    function startGame() {
      nickname = document.getElementById("nickname").value.trim();
      if (!nickname) { alert("Digite seu nick!"); return; }

      document.getElementById("start").style.display = "none";

      startCountdown(() => {
        document.getElementById("quiz").style.display = "block";
        startTime = new Date();
        showQuestion();
      });
    }

    function startCountdown(callback) {
      let countdown = 5;
      const countdownDiv = document.createElement("div");
      countdownDiv.id = "countdownDiv";
      document.body.style.backgroundColor = "black"; 
      document.body.appendChild(countdownDiv);

      const interval = setInterval(() => {
        countdownDiv.textContent = countdown;
        countdown--;

        if (countdown < 0) {
          clearInterval(interval);
          document.body.removeChild(countdownDiv);
          document.body.style.backgroundColor = ""; // volta ao normal
          callback();
        }
      }, 1000);
    }

    function showQuestion() {
      if (currentQuestion >= questions.length) {
        endGame();
        return;
      }

      const q = questions[currentQuestion];
      const quizDiv = document.getElementById("quiz");
      quizDiv.innerHTML = `<div class="question">${q.q}</div>`;
      q.options.forEach((opt, i) => {
        const btn = document.createElement("button");
        btn.textContent = opt;
        btn.onclick = () => checkAnswer(i);
        quizDiv.appendChild(btn);
      });
    }

    function checkAnswer(choice) {
      const soundCorrect = document.getElementById("soundCorrect");
      const soundWrong = document.getElementById("soundWrong");

      if (choice === questions[currentQuestion].answer) {
        score++;
        soundCorrect.play();
      } else {
        soundWrong.play();
      }
      currentQuestion++;
      showQuestion();
    }

    function endGame() {
      endTime = new Date();
      const timeTaken = Math.floor((endTime - startTime) / 1000);

      const resultsDiv = document.getElementById("results");
      resultsDiv.style.display = "block";
      document.getElementById("quiz").style.display = "none";

      const now = new Date();
      const formattedDate = now.toLocaleString();

      resultsDiv.innerHTML = `
        <h2>Resultado Final</h2>
        <p>Nick: ${nickname}</p>
        <p>PontuaÃ§Ã£o: ${score}</p>
        <p>Tempo: ${timeTaken} segundos</p>
        <p>Data/Hora: ${formattedDate}</p>
        <button onclick="saveResult('${nickname}', ${score}, ${timeTaken}, '${formattedDate}')">Salvar Resultado</button>
      `;
    }

    async function saveResult(nick, pontos, tempo, dataHora) {
      await db.collection("resultados").add({
        nick, pontos, tempo, dataHora
      });
      alert("Resultado salvo com sucesso!");
    }

    // Exemplo admin (simulaÃ§Ã£o: sÃ³ aparece se nick == "admin")
    window.onload = async () => {
      if (nickname === "admin") {
        document.getElementById("adminPanel").style.display = "block";
      }
    };
  </script>
</body>
</html>
